<?php
  //login 
  echo <<<_END
  <html>
  <head>
	<script src = "validate_user.js">
	</script>
	<noscript> Sorry, your browser does not support JavaScript.
	</noscript>
  </head>
  <form id = "log" action = "login_admin.php" method = "post" onsubmit = "return validate_user(log)">
  <pre>
  Admin <input type = "text" name = "username">
  Password <input type = "password" name = "password">
  <input type = "submit" value = "CHECK ACCOUNT">
  </pre></form>
  </html>
_END;
    if(isset($_POST['username']) && isset($_POST['password'])){
		//initalize variables
		$new_user = '';
		$new_pass = '';
		$query = '';
		$result = '';
		$rows = 0;
		$conn = NULL;
		//validation
		require_once "validate_user.php";
		if(validate_user($_POST['username'], $_POST['password']) != "") {
			echo validate_user($_POST['username'], $_POST['password']);
			return;
		}
		$new_user = sanitizeString($_POST['username']);
		$new_pass = sanitizeString($_POST['password']);
	
		//hash password
		require_once "login_info.php";
		$new_pass = hash('ripemd128', "$salt1$new_pass$salt2");
		//establish connection to database or fail die
		$conn = new mysqli($hostname, $username, $password, $dbname);
		if($conn->connect_error) die($conn->connect_error);
		else {
			//verify user or quit
			if($username == $new_user && $password == $new_pass) ;
			else die("Incorrect Username/Password.");
			//set cookie and start session
			session_start();
			$_SESSION['id'] = hash('ripemd128', "$username$password");
			$_SESSION['check'] = hash('ripemd128', $_SERVER['REMOTE_ADDR'] . $_SERVER['HTTP_USER_AGENT']);
			//close connetion
			$conn->close();
			header('Location: upload_admin.php');
		}
	} 

	function sanitizeString($var) {
	$var = stripslashes($var);
	$var = strip_tags($var);
	$var = htmlentities($var);
	return $var;
	}

?>